{"title":"神码","uid":"9bff8ffb01d7d468e2440782e4881eec","slug":"神码","date":"2022-03-09T03:02:03.000Z","updated":"2022-03-09T03:02:53.994Z","comments":true,"path":"api/articles/神码.json","keywords":null,"cover":null,"content":"<h1 id=\"第一阶段第二任务配置\"><a href=\"#第一阶段第二任务配置\" class=\"headerlink\" title=\"第一阶段第二任务配置\"></a>第一阶段第二任务配置</h1><ol>\n<li>RS和WS开启telnet登录功能，配置使用telnet方式登录终端界面前显示如下授权信息：“WARNING!!! Authorised access only, all of your done will be recorded! Disconnected IMMEDIATELY if you are not an authorised user! Otherwise, we retain the right to pursue the legal responsibility”。</li>\n</ol>\n<p>1.开启telnet连接<br>1)设置vlan 的IP地址<br>(2)   telnet-server enable     #开启telnet<br>(3)添加用户<br>(4)banner login WARNING!!! Authorised access only, all of your done will be recorded! Disconnected IMMEDIATELY if you are not an authorised user! Otherwise, we retain the right to pursue the legal responsibility #显示授权信息</p>\n<ol start=\"2\">\n<li><p>总部部署了一套网管系统实现对核心RS进行管理，网管系统IP为：172.16.100.21，读团体值为：ABC2022，版本为V2C， RS Trap信息实时上报网管，当MAC地址发生变化时，也要立即通知网管发生的变化，每35s发送一次；<br>DCRS(config)#snmp-server enable<br>DCRS(config)#snmp-server host 172.16.100.21 v2c ABC2022<br>DCRS(config)#snmp-server enable traps<br>DCRS(config)#snmp-server enable traps mac-notification<br>DCRS(config)#mac-address-learning cpu-control<br>DCRS(config)#mac-address-table notification<br>DCRS(config)#mac-address-table notification interval 35</p>\n</li>\n<li><p>RS出口往返流量发送给NETLOG，由NETLOG对收到的数据进行用户所要求的分析;(端口镜像)<br>DCRS(config)#monitor session 1 source interface ethernet 1&#x2F;0&#x2F;20 rx<br>DCRS(config)#monitor session 1 source interface ethernet 1&#x2F;0&#x2F;20 tx<br>DCRS(config)#monitor session 1 destination interface ethernet 1&#x2F;0&#x2F;3</p>\n</li>\n<li><p>对RS上VLAN40开启以下安全机制：<br>业务内部终端相互二层隔离，启用环路检测，环路检测的时间间隔为10s，发现环路以后关闭该端口，恢复时间为30分钟； 如私设DHCP服务器关闭该端口;防止ARP欺骗攻击；<br>DCRS(config)# vlan 40<br>DCRS(config-vlan40)# isolate-port apply l2<br>DCRS(config)#int e 1&#x2F;0&#x2F;4<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;4)#loopback-detection control shutdown<br>DCRS(config)#loopback-detection interval-time 10 10<br>DCRS(config)#loopback-detection control-recovery timeout 1800<br>DCRS(config)#ip dhcp snooping enable<br>DCRS(config)#int e 1&#x2F;0&#x2F;4<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;4)#ip dhcp snooping action shutdown<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;4)#int e 1&#x2F;0&#x2F;1<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;1)#ip dhcp snooping trust</p>\n</li>\n<li><p>使总部VLAN10，30，40业务的用户访问INTERNET往返数据流都经过FW进行最严格的安全防护; RS使用相关VPN技术，模拟INTERNET ,VPN名称为INTERNET地址为218.5.18.2；</p>\n</li>\n</ol>\n<p>DCRS(config)#ip access-list extended yewu<br>DCRS(config-ip-ext-nacl-yewu)#permit  ip 172.16.10.0 0.0.0.255 any-destination<br>DCRS(config-ip-ext-nacl-yewu)#permit  ip 172.16.30.0 0.0.0.63 any-destination<br>DCRS(config-ip-ext-nacl-yewu)#permit  ip 172.16.40.0 0.0.0.63 any-destination<br>DCRS(config-ip-ext-nacl-yewu)#exit<br>DCRS(config)#class-map yewu<br>DCRS(config-classmap-yewu)#match access-group yewu<br>DCRS(config-classmap-yewu)#exit<br>DCRS(config)#policy-map yewu<br>DCRS(config-policymap-yewu)#class yewu<br>DCRS(config-policymap-yewu-class-yewu)#set ip nexthop 10.0.0.1<br>DCRS(config-policymap-yewu-class-yewu)#exit<br>DCRS(config)#int e 1&#x2F;0&#x2F;20<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;20)#service-policy input yewu<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;20)#exit<br>DCRS(config)#int e 1&#x2F;0&#x2F;3<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;3)#service-policy input yewu<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;3)#exit<br>&#x2F;&#x2F;使用GRE隧道（配置之前确定路由可达，配置一条静态路由）<br>DCRS(config)#interface tunnel 1<br>DCRS(config-if-tunnel1)#tunnel mode gre ip<br>DCRS(config-if-tunnel1)#tunnel source 192.168.100.254<br>DCRS(config-if-tunnel1)#tunnel destination 10.0.0.1<br>DCRS(config-if-tunnel1)#ip ad 10.1.1.1 255.255.255.252<br>DCRS(config-if-tunnel1)#exit<br>下面是防火墙GRE隧道的配置<br>DCFW(config)# tunnel gre 1<br>DCFW(config-tunnel-gre)# source 10.0.0.1<br>DCFW(config-tunnel-gre)# destination 192.168.100.254<br>DCFW(config-tunnel-gre)# exit<br>DCFW(config)# interface tunnel1<br>DCFW(config-if-tun1)# ip address 10.1.1.2&#x2F;30<br>6.WS与RS之间配置RIPng， 是VLAN30与VLAN50可以通过IPv6通信；<br>IPv6业务地址规划如下，其它IPv6地址自行规划：<br>业务    IPV6地址<br>VLAN30    2001::30::254&#x2F;64<br>VLAN50    2001::50::254&#x2F;64</p>\n<p>DCRS(config)#vlan 30<br>DCRS(config-vlan30)#vlan 50<br>DCRS(config-vlan50)#int vlan 30<br>DCRS(config-if-vlan30)#ipv6  address 2001:1:30::254&#x2F;64<br>DCRS(config-if-vlan30)#ipv6  router rip<br>DCRS(config-if-vlan30)#exit<br>DCRS(config)#int vlan 50<br>DCRS(config-if-vlan50)#ipv address 2001:1:50::254&#x2F;64<br>DCRS(config-if-vlan50)#ipv6 router rip</p>\n<p>7.FW、RS、WS之间配置OSPF area 0 开启基于链路的MD5认证，密钥自定义；<br>DCRS(config)#router ospf 100<br>DCRS(config-router)#network 192.168.100.0&#x2F;24 area 0<br>DCRS(config-router)#network 172.16.40.0&#x2F;26 area 0<br>DCRS(config-router)#network 10.1.1.1&#x2F;30 area 0<br>DCRS(config-router)#exit<br>DCRS(config-vlan100)#int vlan 100<br>DCRS(config-if-vlan100)#ip ad 192.168.100.254 255.255.255.0<br>DCRS(config-if-vlan100)#ip ospf authentication message-digest<br>DCRS(config-if-vlan100)#ip ospf authentication-key 0 123456<br>DCRS(config-if-vlan100)#exit<br>&#x2F;&#x2F;WS同上，防火墙如下：<br>DCFW(config)# ip vrouter trust-vr<br>DCFW(config-vrouter)# router ospf<br>DCFW(config-router)# router-id 1.1.1.1<br>DCFW(config-router)# network 218.5.18.1&#x2F;27 area 0<br>DCFW(config-router)# network 10.0.0.1&#x2F;30 ar 0<br>DCFW(config-router)# network 1.1.1.1&#x2F;32 ar 0</p>\n<p>8.为了有效减低能耗，要求每天晚上20:00到早上07:00把RS端口指示灯全部关闭；如果RS的11端口的收包速率超过30000则关闭此端口，恢复时间5分钟，并每隔10分钟对端口的速率进行统计；为了更好地提高数据转发的性能，RS交换中的数据包大小指定为1600字节；<br>DCRS(config)#time-range 1<br>DCRS(config-time-range-1)#absolute start 20:00:00 2021.1.1 end 7:00:00 2031.12.31<br>DCRS(config)#port-led shutdown time-range 1<br>DCRS(config)#int e1&#x2F;0&#x2F;11<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;11)#rate-violation all 30000<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;11)#rate-violation control shutdown recovery 300<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;11)#exit<br>DCRS(config)#port-rate-statistics interval 600<br>DCRS(config)#mtu 1600  &#x2F;&#x2F;最大传输单元</p>\n<p>9.配置认证服务器，IP地址是192.168.2.100，radius key是dcn2018;<br>DCRS(config)#radius-server authentication host 192.168.2.100<br>DCRS(config)#radius-server key dcn2018<br>DCRS(config)#aaa enable</p>\n<p>10.在公司总部的DCRS上配置，需要在交换机E1&#x2F;0&#x2F;21接口上开启基于MAC地址模式的认证，认证通过后才能访问网络<br>DCRS(config)#int e 1&#x2F;0&#x2F;21<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;21)#dot1x port-method macbased<br>Set 802.1x port method on port Ethernet1&#x2F;0&#x2F;21 ok.<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;21)#dot1x enable<br>11.总部启用 MSTP 协议，NAME 为 2019DCN、 Revision-level 1，实 例 1 中包括 VLAN10；实例 2 中包括 VLAN20、要求两条链路负载分 担,其中 VLAN10 业务数据在 E1&#x2F;0&#x2F;4 进行数据转发，要求 VLAN20 业务数据在E1&#x2F;0&#x2F;5进行数据转发，通过在DCWS两个端口设置COST 值 2000000 实现;配置 DCRS 连接终端接口立即进入转发模式且在 收到 BPDU 时自动关闭端口;防止从 DCWS 方向的根桥抢占攻击;<br>DCRS:<br>spanning-tree mst configuration<br>name 2019DCN<br>revision-level 1<br>instance 0 vlan 1-9;11-19;21-4094<br>instance 1 vlan 10<br>instance 2 vlan 20<br>exit<br>spanning-tree<br>spanning-tree mst 1 priority 0<br>spanning-tree mst 2 priority 0<br>DCRS 上实例 1 关联 VLAN 10 、实例 2 关联 VLAN 20 NAME ：2019DN 共 1 分,错配少配不得分；<br>DCWS:<br>panning-tree mst configuration<br>name 2019DCN<br>revision-level 1<br>instance 0 vlan 1-9;11-19;21-4094<br>instance 1 vlan 10<br>instance 2 vlan 20<br>2.DCWS 上实例 1 关联 VLAN 10 、实例 2 关联 VLAN 20 NAME ：2019DN 共 1 分 ，错配少配不得分；<br>Interface Ethernet1&#x2F;0&#x2F;4<br>spanning-tree mst 2 cost 2000000<br>Interface Ethernet1&#x2F;0&#x2F;5<br>spanning-tree mst 1 cost 2000000<br>3.在 DCWS 端口 E1&#x2F;0&#x2F;4-E1&#x2F;0&#x2F;5 配置正确 1 分, 错配少配不得分；<br>Interface Ethernet1&#x2F;0&#x2F;7-12<br>spanning-tree portfast bpduguard<br>6.    在 DCRS 上 E1&#x2F;0&#x2F;7-E1&#x2F;0&#x2F;12 配置共 1 分 . 错配少配不得分；<br>Interface Ethernet1&#x2F;0&#x2F;7<br>spanning-tree mst 1 rootguard<br>Interface Ethernet1&#x2F;0&#x2F;8<br>spanning-tree mst 2 rootguard<br>Interface Ethernet1&#x2F;0&#x2F;9<br>spanning-tree mst 1 rootguard<br>Interface Ethernet1&#x2F;0&#x2F;10<br>spanning-tree mst 2 rootguard<br>Interface Ethernet1&#x2F;0&#x2F;11<br>spanning-tree mst 2 rootguard<br>Interface Ethernet1&#x2F;0&#x2F;12<br>spanning-tree mst 2 rootguard</p>\n<p>12.总部核心交换机 DCRS 检测到 VLAN40 中私设 DHCP 服务器关闭该 端口;<br>DCWS(config)#ip dhcp snooping enable<br>DCWS(config)#interface ethernet 1&#x2F;0&#x2F;4<br>DCWS(config-if-ethernet1&#x2F;0&#x2F;4)#ip dhcp snooping action shutdown<br>DCWS(config-if-ethernet1&#x2F;0&#x2F;4)#exit<br>DCWS(config)#interface e1&#x2F;0&#x2F;1<br>DCWS(config-if-ethernet1&#x2F;0&#x2F;1)#ip dhcp snooping trust </p>\n<p>12.总部核心交换机 DCRS 开启某项功能,防止 VLAN40 下 ARP 欺骗攻 击;<br>DCWS(config)#ip dhcp snooping en<br>DCWS(config)#ip dh snooping binding enable<br>DCWS(config)#interface ethernet 1&#x2F;0&#x2F;1<br>DCWS(config-if-ethernet1&#x2F;0&#x2F;1)#ip dhcp snooping binding user-control<br>DCWS(config-if-ethernet1&#x2F;0&#x2F;1)#</p>\n<p>13.2017 年勒索蠕虫病毒席卷全球，爆发了堪称史上最大规模的网络 攻击，通过对总部核心交换机 DCRS 所有业务 VLAN 下配置访问控 制策略实现双向安全防护;<br>DCWS(config)#ip access-list extended bingdu<br>DCWS(config-ip-ext-nacl-bingdu)#deny tcp any-source any-destination d-port 135<br>DCWS(config-ip-ext-nacl-bingdu)#deny tcp any-source any-destination d-port 136<br>DCWS(config-ip-ext-nacl-bingdu)#deny tcp any-source any-destination d-port 137<br>DCWS(config-ip-ext-nacl-bingdu)#deny tcp any-source any-destination d-port 138<br>DCWS(config-ip-ext-nacl-bingdu)#deny tcp any-source any-destination d-port 139<br>DCWS(config-ip-ext-nacl-bingdu)#deny tcp any-source any-destination d-port 445<br>DCWS(config-ip-ext-nacl-bingdu)#permit ip any-source any-destination<br>DCWS(config-ip-ext-nacl-bingdu)#exit<br>DCWS(config)#vacl ip access-group bingdu in vlan 10;20;30;40<br>DCWS(config)#vacl ip access-group bingdu out vlan 10;20;30;40</p>\n<p>14.配置公司总部的DCRS，通过DCP（Dynamic CPU Protection）策略，防止DCRS受到来自于全部物理接口的DOS（Denial Of Service）攻击，每秒最多30个包<br>DCRS(config)#dcp en<br>DCRS(config)#dcp limit-rate 30</p>\n<p>15.为减少内部ARP广播询问VLAN网关地址，在全局下配置DCRS每隔300S发送免费ARP</p>\n<pre><code>DCRS(config)#ip gratuitous-arp 300\n</code></pre>\n<p>16.在端口ethernet1&#x2F;0&#x2F;7上，将属于网段192.168.40.0内的报文带宽限制为10M比特&#x2F;秒，突发4M字节，超过带宽的该网段内的报文一律丢弃。<br>DCRS(config)#access-list 100 permit ip 192.168.40.0 0.0.0.255 any-destination<br>DCRS(config)#class-map 100<br>DCRS(config-classmap-100)#match access-group 100<br>DCRS(config-classmap-100)#exit<br>DCRS(config)#policy-map 100<br>DCRS(config-policymap-100)#class 100<br>DCRS(config-policymap-100-class-100)#accounting<br>DCRS(config-policymap-100-class-100)#exit<br>DCRS(config-policymap-100)#exit<br>DCRS(config)#mls qos aggregate-policy 100 10000 4000 exceed-action drop<br>17.为了防止DOS攻击在交换上开启防端口欺骗功能、防IP Spoofing功能、防ICMP碎片攻击功能，且ICMPv4净荷长度小于100。<br>DCRS(config)#dosattack-check tcp-flags enable</p>\n<p>18.交换上开启web管理，为了提高访问的安全性，使用SSL功能，客户和交换机之间的通信通过SSL连接进行，端口号为1060，使用rc4-128加密算法，账号密码都为DCN2019。<br>DCRS(config)#ip http secure-port 1060<br>DCRS(config)#ip http secure-ciphersuite rc4-128-sha<br>DCRS(config)#ip http secure-server<br>DCRS(config)#username DCN2019 password 0 DCN2019<br>19.为了便于对网路流量进行分析，需要对交换连接防火墙接口数据进行采样分析，采样速率进出都为100000，采样时间间隔为30秒，分析服务器为192.168.40.100，代理源地址为10.0.0.2。<br>DCRS(config)#sflow agent-address 10.0.0.2<br>DCRS(config)#sflow destination 192.168.40.1<br>DCRS(config)#interface ethernet 1&#x2F;0&#x2F;1<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;1)#sflow rate input 100000<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;1)#sflow rate output 100000<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;1)#sflow counter-interval 30<br>20.DCRS为接入交换机，为终端产生防止MAC地址防洪攻击，请配置端口安全，每个已划分VLAN的端口最多学习到5个MAC地址，发生违规阻止后续违规流量通过，不影响已有流量并产生LOG日志；连接PC1的接口为专用接口，限定只允许PC1的MAC地址可以连接；<br>DCRS(config)#interface ethernet 1&#x2F;0&#x2F;15-20<br>DCRS(config-if-port-range)#switchport port-security<br>DCRS(config-if-port-range)#switchport port-security maximum 5<br>7.    DCRS上配置，VLAN40的成员接口开启广播风暴抑制功能，参数设置为2100pps;<br>DCRS(config-if-ethernet1&#x2F;0&#x2F;1)#storm-control broadcast 2100</p>\n","text":"第一阶段第二任务配置 RS和WS开启telnet登录功能，配置使用telnet方式登录终端界面前显示如下授权信息：“WARNING!!! Authorised access only, all of your done will be recorded! Disconnected...","link":"","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E7%AC%AC%E4%BA%8C%E4%BB%BB%E5%8A%A1%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">第一阶段第二任务配置</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{}}